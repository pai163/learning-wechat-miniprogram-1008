<!-- pages/rewards/rewards.wxml -->
<view class="container">
  <!-- ç¢ç‰‡æ•°é‡æ˜¾ç¤º -->
  <view class="token-display">
    <text class="token-title">æˆ‘çš„å­¦ä¹ ç¢ç‰‡</text>
    <text class="token-count">{{fragments}} ä¸ª</text>
  </view>

  <!-- å¥–åŠ±å…‘æ¢åˆ—è¡¨ -->
  <view class="rewards-section">
    <view class="section-header">
      <text class="section-title">å¥–åŠ±å…‘æ¢</text>
      <button class="add-reward-btn" bindtap="openAddRewardModal">+ æ·»åŠ å¥–åŠ±</button>
    </view>

    <view class="rewards-list">
      <block wx:if="rewards.length > 0">
        <view wx:for="{{rewards}}" wx:key="id" class="reward-item">
          <view class="reward-info">
            <text class="reward-name">{{item.name}}</text>
            <text class="reward-cost">éœ€è¦ {{item.cost}} ä¸ªç¢ç‰‡</text>
          </view>
          <button 
            class="exchange-btn {{fragments >= item.cost ? 'enabled' : 'disabled'}}"
            bindtap="exchangeReward" 
            data-id="{{item.id}}"
            disabled="{{fragments < item.cost}}"
          >
            å…‘æ¢
          </button>
        </view>
      </block>
      <view wx:else class="empty-message">
        <text>æš‚æ— å¥–åŠ±ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ å§ï¼</text>
      </view>
    </view>
  </view>

  <!-- å…‘æ¢è®°å½• -->
  <view class="exchange-history">
    <text class="section-title">å…‘æ¢è®°å½•</text>
    <view class="history-list">
      <block wx:if="exchangeRecords.length > 0">
        <view wx:for="{{exchangeRecords}}" wx:key="index" class="history-item">
          <view class="history-info">
            <text class="history-reward">{{item.rewardName}}</text>
            <text class="history-date">{{item.date}}</text>
          </view>
        </view>
      </block>
      <view wx:else class="empty-message">
        <text>æš‚æ— å…‘æ¢è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ å¥–åŠ±å¼¹çª— -->
  <view class="modal" wx:if="showAddRewardModal" bindtap="closeAddRewardModal">
    <view class="modal-content" catchtap="stopPropagation">
      <text class="modal-title">æ·»åŠ å¥–åŠ±</text>
      <input 
        class="reward-input" 
        placeholder="è¾“å…¥å¥–åŠ±åç§°" 
        bindinput="onRewardNameInput" 
        value="{{newRewardName}}"
      />
      <input 
        class="cost-input" 
        placeholder="è¾“å…¥æ‰€éœ€ç¢ç‰‡æ•°é‡" 
        type="number" 
        bindinput="onRewardCostInput" 
        value="{{newRewardCost}}"
      />
      <view class="modal-buttons">
        <button class="cancel-btn" bindtap="closeAddRewardModal">å–æ¶ˆ</button>
        <button class="save-btn" bindtap="saveReward">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- å…‘æ¢ç¡®è®¤å¼¹çª— -->
  <view class="modal" wx:if="showExchangeConfirmModal" bindtap="closeExchangeConfirmModal">
    <view class="modal-content" catchtap="stopPropagation">
      <text class="modal-title">ç¡®è®¤å…‘æ¢</text>
      <text class="confirm-text">ç¡®å®šè¦å…‘æ¢ "{{selectedReward.name}}" å—ï¼Ÿ
        éœ€è¦æ¶ˆè€— {{selectedReward.cost}} ä¸ªç¢ç‰‡</text>
      <view class="modal-buttons">
        <button class="cancel-btn" bindtap="closeExchangeConfirmModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="confirmExchange">ç¡®è®¤å…‘æ¢</button>
      </view>
    </view>
  </view>

  <!-- å…‘æ¢æˆåŠŸå¼¹çª— -->
  <view class="modal" wx:if="showExchangeSuccessModal" bindtap="closeExchangeSuccessModal">
    <view class="modal-content" catchtap="stopPropagation">
      <text class="success-icon">ğŸ‰</text>
      <text class="success-text">å…‘æ¢æˆåŠŸï¼
        æ­å–œä½ è·å¾— "{{selectedReward.name}}"</text>
      <button class="confirm-btn" bindtap="closeExchangeSuccessModal">ç¡®å®š</button>
    </view>
  </view>

  <!-- æç¤ºå¼¹çª— -->
  <view class="toast" wx:if="showToast">
    <text>{{toastMessage}}</text>
  </view>
</view>